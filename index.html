<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Ask PDF Bot</title>
<script src="https://accounts.google.com/gsi/client" async defer></script>
<style>
  body { font-family: Arial, sans-serif; max-width: 600px; margin: auto; padding: 1rem; }
  #answer { white-space: pre-wrap; margin-top: 1rem; background: #f0f0f0; padding: 1rem; border-radius: 5px; }
  #login-status { margin-bottom: 1rem; }
</style>
</head>
<body>

<h2>Ask PDF Bot</h2>

<div id="login-status">Please sign in with your Google account to continue.</div>

<div id="login-button"></div>

<div id="question-area" style="display:none;">
  <textarea id="question" rows="4" style="width: 100%;" placeholder="Type your question here..."></textarea>
  <button id="ask-btn">Ask</button>
  <div id="answer"></div>
</div>

<script>
  const allowedEmail = "your.specific.email@gmail.com"; // CHANGE this to your Gmail

  let userEmail = null;

  function handleCredentialResponse(response) {
    // Decode JWT token to get user info (use atob for base64url decoding)
    const payload = JSON.parse(atob(response.credential.split('.')[1].replace(/-/g, '+').replace(/_/g, '/')));
    userEmail = payload.email;

    if(userEmail === allowedEmail) {
      document.getElementById("login-status").textContent = `Signed in as ${userEmail}`;
      document.getElementById("login-button").style.display = "none";
      document.getElementById("question-area").style.display = "block";
    } else {
      document.getElementById("login-status").textContent = "Access denied. Unauthorized email.";
      document.getElementById("login-button").style.display = "none";
      document.getElementById("question-area").style.display = "none";
    }
  }

  window.onload = () => {
    google.accounts.id.initialize({
      client_id: "YOUR_GOOGLE_CLIENT_ID.apps.googleusercontent.com", // Put your client ID here
      callback: handleCredentialResponse
    });
    google.accounts.id.renderButton(
      document.getElementById("login-button"),
      { theme: "outline", size: "large" }
    );
    google.accounts.id.prompt(); // Show prompt automatically
  };

  document.getElementById("ask-btn").onclick = async () => {
    const question = document.getElementById("question").value.trim();
    if (!question) return alert("Please enter a question.");

    const response = await fetch("https://your-worker.yourdomain.workers.dev", {  // your Cloudflare Worker URL
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ question }),
    });

    if (response.ok) {
      const data = await response.json();
      document.getElementById("answer").textContent = data.answer || "No answer found.";
    } else {
      const errorText = await response.text();
      document.getElementById("answer").textContent = `Error: ${errorText}`;
    }
  };
</script>

</body>
</html>
