<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Login</title>
  <script src="https://accounts.google.com/gsi/client" async defer></script>
</head>
<body>
  <h1>Login with Google</h1>
  <div id="g_id_signin"></div>
  <script>
    const GOOGLE_CLIENT_ID = "723269872009-n5s7di6on92goolcvriuo4lp6db0l5kl.apps.googleusercontent.com";
    const ORIGIN = "https://mohamadmonzer-a.github.io"; // your site origin

    
    function handleCredentialResponse(response) {
      // response.credential is the JWT ID token
      fetch("https://your-worker-endpoint/login", {
        method: "POST",
        credentials: "include", // important to allow cookies
        headers: {
          "Content-Type": "application/json",
        },
        body: JSON.stringify({ idToken: response.credential }),
      })
        .then(res => res.json())
        .then(data => {
          if (data.message === "Login successful") {
            // Redirect to main app page
            window.location.href = ORIGIN + "/index.html";
          } else {
            alert("Login failed: " + (data.error || "Unknown error"));
          }
        })
        .catch(err => {
          alert("Login error: " + err.message);
        });
    }

    window.onload = () => {
      google.accounts.id.initialize({
        client_id: GOOGLE_CLIENT_ID,
        callback: handleCredentialResponse,
        ux_mode: "popup",
      });
      google.accounts.id.renderButton(
        document.getElementById("g_id_signin"),
        { theme: "outline", size: "large" }
      );
      google.accounts.id.prompt(); // optionally show the One Tap prompt
    };
  </script>
</body>
</html>
