<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Login</title>
  <script src="https://accounts.google.com/gsi/client" async defer></script>
  <style>
    body { font-family: Arial, sans-serif; max-width: 400px; margin: 2rem auto; text-align: center; }
    #message { margin-top: 1rem; color: red; }
  </style>
</head>
<body>
  <h1>Login</h1>
  <div id="g_id_onload"
       data-client_id="723269872009-n5s7di6on92goolcvriuo4lp6db0l5kl.apps.googleusercontent.com"
       data-callback="handleCredentialResponse"
       data-auto_prompt="false">
  </div>
  <div class="g_id_signin" data-type="standard"></div>
  <div id="message"></div>

  <script>
    async function handleCredentialResponse(response) {
      const idToken = response.credential;
      const res = await fetch('https://vector-rag.monzer-mohamad-a.workers.dev/login', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        credentials: 'include',
        body: JSON.stringify({ idToken }),
      });
      const data = await res.json();

      if (res.ok) {
        // Login success, redirect to index.html
        window.location.href = 'index.html';
      } else {
        document.getElementById('message').textContent = data.error || 'Login failed';
      }
    }
  </script>
</body>
</html>
